---
title: "Dexamethasone treatment to COVID patients"
output:
  html_document:
    df_print: paged
  pdf_document: default
  toc: TRUE
---

```{r, echo = F}
knitr::opts_chunk$set(warning = F, message = F)
```

```{r load_libraries, echo = F, message = F, warning = F}
library(readxl)
library(tidyverse)
library(ggplot2)
library(ggpubr)
library(reshape2)
library(broom)
library(betareg)
library(effects)
library(stringr)
library(ggstatsplot)
```

```{r load_datasets}
# delta alpha clinical table
PNT <- read_excel("~/Documents/charite/Dexa/2021-09-23_Dexa_Charite_UKK_all results Alpha and Delta clinical.xlsx") %>% 
  select("PatID Studie 1", 
         "Tag PSO", 
         "Days", 
         "Dexamethason", 
         "Serum ID50: Variant B.1.1.7", 
         "Serum ID50: Variant B.1.617.2") %>%
  rename(PatID_Studie1 = `PatID Studie 1`, 
         TagPSO = `Tag PSO`,
         B.1.1.7 = `Serum ID50: Variant B.1.1.7`, 
         B.1.617.2 = `Serum ID50: Variant B.1.617.2`,
         Dexa = Dexamethason) %>%
  mutate(PatID_Studie1 = str_replace(PatID_Studie1, c("C19-CB-"), "")) %>% 
  mutate(PatID_Studie1 = as.character(as.numeric(PatID_Studie1))) %>% 
  filter(!(Days == "nd")) %>% 
  mutate(TagPSO = replace(TagPSO, PatID_Studie1=="435", "6")) %>% 
  mutate(TagPSO = as.numeric(TagPSO))

# FACS results
facs <- read_excel("~/Documents/charite/Dexa//Mastertable FACS results 2021 09 12 CT LB.xlsx") %>% 
  select("Studie 1", 
         "PatID Studie 1", 
         "Zeitraum 2021 09 03 und post Impfung W3-6", 
         "Tag PSO", 
         "Dexa", 
         "Marker 1", 
         "Marker 2", 
         "#CEFX-unstim negativ auf 0", 
         "#S1-unstim negativ auf 0", 
         "#S2-unstim negativ auf 0", 
         "#SEB-unstim negativ auf 0") %>%
  rename(Studie1 = `Studie 1`, 
         PatID_Studie1 = `PatID Studie 1`, 
         Timepoint = `Zeitraum 2021 09 03 und post Impfung W3-6`,
         TagPSO = `Tag PSO`, 
         Marker1 = `Marker 1`, 
         Marker2 = `Marker 2`) %>%
  rename(CEFX = `#CEFX-unstim negativ auf 0`, 
         S1 = `#S1-unstim negativ auf 0`, 
         S2 = `#S2-unstim negativ auf 0`, 
         SEB = `#SEB-unstim negativ auf 0`) %>%
  filter(!is.na(CEFX) | !is.na(S1) | !is.na(S2) | !is.na(SEB)) %>%
  mutate(PatID_Studie1 = as.character(PatID_Studie1)) %>% 
  mutate(Timepoint = replace(Timepoint, PatID_Studie1=="435", "W 2")) %>% 
  filter(!(PatID_Studie1 == "183" | 
           PatID_Studie1 == "22" | 
           PatID_Studie1 == "53" | 
           PatID_Studie1 == "88" | 
           PatID_Studie1 == "115" | 
           PatID_Studie1 == "120" | 
           PatID_Studie1 == "133" | 
           PatID_Studie1 == "153"))


# meta data
meta <- read_excel("~/Documents/charite/Dexa//Metadaten_FACS_PNT_2021 10 12_PS.xlsx") %>%
  rename(PatID_Studie1 = `PatID Studie 1 kurz`, 
         Age = `Alter / Geschaetztes Alter bei Einschluss gr 3 Jahre`, 
         Sex = `Geschlecht bei der Geburt` ,
         WHO = `#WHO max`, 
         Charlson = `#Charlson Comorbidity Index STP`,
         VacDaysDiff = `#DateDiff Impfung PSO`) %>%
  mutate(PatID_Studie1 = as.character(PatID_Studie1)) %>% 
  filter(!grepl(.$Bemerkung, pattern = "Immun", ignore.case = T)) %>% 
  filter(!(PatID_Studie1 == "183" | 
           PatID_Studie1 == "22" | 
           PatID_Studie1 == "53" | 
           PatID_Studie1 == "88" | 
           PatID_Studie1 == "115" | 
           PatID_Studie1 == "120" | 
           PatID_Studie1 == "133" | 
           PatID_Studie1 == "153"))

# serology
sero <- read_excel("~/Documents/charite/Dexa/Serology_20211006.xlsx") %>% 
  rename(PatID_Studie1 = `PatID Studie 1`,
         IgG = `IgG BAU/ml`,
         TagPSO = `Tag PSO`, 
         Timepoint = Zeitraum, 
         Dexa = `Dexamethason\r\n0 = no\r\n1 = yes\r\n3 = not applicable`) %>% 
  mutate(PatID_Studie1 = str_replace(PatID_Studie1, c("C19-CB-"), "")) %>% 
  mutate(PatID_Studie1 = as.character(as.numeric(PatID_Studie1))) %>% 
  mutate(IgG = as.numeric(str_replace(IgG, c(","), "\\."))) %>% 
  filter(!(PatID_Studie1 == "183" | 
           PatID_Studie1 == "22" | 
           PatID_Studie1 == "53" | 
           PatID_Studie1 == "88" | 
           PatID_Studie1 == "115" | 
           PatID_Studie1 == "120" | 
           PatID_Studie1 == "133" | 
           PatID_Studie1 == "153"))

SRT <- c("S1", "S2", "CEFX", "SEB")
strain <- c("B.1.1.7", "B.1.617.2")

```
Notes:
1. Left out the 7 patients with immunosuppression
2. Changed all patient IDs to short IDs (eg. C19-CB-0010 to 10)
3. To avoid losing data points, where there was no entry for time point bins, I manually entered them as follows: (Please correct me where necessary!)\
+ Tag PSO 6 -> W2 ("Tag PSO" range for W2 bin was from 8 to 18). This has data points from only 1 patient.\
+ d25-60 -> W3-6\
+ d39-60 -> W3-6\
+ d39-46 -> W3-6\
+ 2-4mo -> M2-4\
+ d80-140 -> M2-4\
+ 5-7mo -> after month 5\
+ PostVac -> 1\
4. Changed PI in serology table to post vacc, if necessary

\pagebreak

# Serology

## IgG levels vs PNT

```{r serology}

# Cor IgG vs PNT at different timepoints
Sero_PNT <- sero %>% 
  left_join(., PNT, by = "PatID_Studie1") %>%
  select(PatID_Studie1, Timepoint, Days, B.1.1.7, B.1.617.2, IgG) %>%
  na.omit()
  

time <- data.frame(time = c("M2-4", "M2-4", "after month 5", "post vacc", "W 2"),
                   days = c("2-4mo", "d80-140", "5-7mo", "PostVac", "NA"))

# get IgG measurements and PNT for the same time points
a = 1
sero_PNT_cor <- data.frame()

for(i in 1:nrow(Sero_PNT))
{
  index_tp <- grep(pattern = Sero_PNT$Timepoint[i], time$time)
  index_dy <- grep(pattern = Sero_PNT$Days[i], time$days)
  if(any(index_tp == index_dy))
  {
    sero_PNT_cor[a,1:6] <- Sero_PNT[i,]
    a = a+1
  }
}

# IgG vs B.1.1.7
sero_PNT_cor %>% 
  ggplot(aes(x = IgG, y = B.1.1.7)) +
  geom_point(alpha = 0.7) +
  facet_wrap(~Timepoint) +
  theme_bw() +
  ggtitle("IgG vs PNT measures at the same time point") +
  xlab("IgG BAU/ml") +
  stat_cor(method = "pearson", label.x = 5000, label.y = 5000, size = 3) +
  geom_smooth(method = "lm", se = F)
ggsave("IgG_PNT_correlation_same_timepoint.png")

# IgG vs B.1.617.2
sero_PNT_cor %>% 
  ggplot(aes(x = IgG, y = B.1.617.2)) +
  geom_point(alpha = 0.7) +
  facet_wrap(~Timepoint) +
  theme_bw() +
  ggtitle("IgG vs PNT measures at the same time point") +
  xlab("IgG BAU/ml") +
  stat_cor(method = "pearson", label.x = 5000, label.y = 5000, size = 3) +
  geom_smooth(method = "lm", se = F)
```

```{r sero_SRT, fig.dim(c(10,8))}

# Cor IgG vs PNT at different timepoints
Sero_SRT <- sero %>% 
  left_join(., facs, by = c("PatID_Studie1", "Timepoint", "Dexa")) %>%
  select(PatID_Studie1, Dexa, Timepoint, Marker1, Marker2, S1, S2, CEFX, SEB, IgG) %>% 
  mutate(Timepoint = replace(Timepoint, PatID_Studie1=="435", "W 2"))

# IgG vs SRT
for(i in SRT)
  print(
    Sero_SRT %>% 
      filter(Marker1=="CD4") %>% 
      ggplot(aes(x = IgG, y = !!sym(i))) +
      geom_point(alpha = 0.7, aes(color = factor(Dexa))) +
      facet_grid(~factor(Timepoint, levels = c("W 2", "M2-4", "after month 5"))) +
      theme_bw() +
      ggtitle("IgG vs SRT (CD4)") +
      xlab("IgG BAU/ml") +
      stat_cor(method = "pearson", label.x = 2000, label.y = 1, size = 3) +
      geom_smooth(method = "lm", se = F)
  )

for(i in SRT)
  print(
    Sero_SRT %>% 
      filter(Marker1=="CD8") %>% 
      ggplot(aes(x = IgG, y = !!sym(i))) +
      geom_point(alpha = 0.7, aes(color = factor(Dexa))) +
      facet_grid(~factor(Timepoint, levels = c("W 2", "M2-4", "after month 5"))) +
      theme_bw() +
      ggtitle("IgG vs SRT (CD8)") +
      xlab("IgG BAU/ml") +
      stat_cor(method = "pearson", label.x = 2000, label.y = 1, size = 3) +
      geom_smooth(method = "lm", se = F)
  )

```


## IgG levels vs Age, Sex

```{r sero_meta}
# cor IgG vs Age, sex, Dexa
Sero_meta <- sero %>% 
  left_join(., meta, by = "PatID_Studie1") %>% 
  left_join(., PNT, by = c("PatID_Studie1", "Dexa")) %>% 
  select(PatID_Studie1, Age, Sex, Timepoint, IgG, Dexa) %>% 
  distinct() %>% 
  filter(!(PatID_Studie1 == "183"))

Sero_meta %>% 
  ggplot(., aes(x = IgG, y = Age)) + 
  geom_point(alpha = 0.7, aes(color = factor(Dexa))) +
  facet_wrap(~Dexa) +
  stat_cor(method = "pearson", label.x = 5000, label.y = 20, size = 3) +
  theme_bw()

my_comparisons <- list(c("Männlich", "Weiblich"))
Sero_meta %>% 
  filter(!is.na(Sex)) %>% 
  ggplot(., aes(x = Sex, y = IgG)) + 
  geom_violin(alpha = 0.7) + 
  geom_jitter(width = 0.1, aes(color = factor(Timepoint))) +
  stat_compare_means(comparisons = my_comparisons) +
  theme_bw()

Sero_meta %>% 
  filter(!is.na(Sex)) %>% 
  ggplot(., aes(x = Sex, y = IgG)) + 
  geom_violin(alpha = 0.7) +
  geom_jitter(width = 0.1, aes(color = factor(Timepoint))) +
  facet_wrap(~Timepoint) +
  stat_compare_means(comparisons = my_comparisons) +
  theme_bw()
  
Sero_meta %>% 
  #filter(!is.na(Sex)) %>% 
  ggplot(., aes(x = factor(Dexa), y = IgG)) + 
  geom_violin(alpha = 0.7) +
  geom_jitter(width = 0.1, aes(color = factor(Timepoint))) +
  facet_wrap(~factor(Timepoint, level = c('W 2', 'W3-6', 'M2-4', 'after month 5', 'post vacc'))) +
  geom_signif(comparisons = list(c("0", "3")), 
        map_signif_level=TRUE, y_position = 15000) +
  geom_signif(comparisons = list(c("0", "1")), 
        map_signif_level=TRUE, y_position = 14700) +
  geom_signif(comparisons = list(c("1", "3")), 
        map_signif_level=TRUE) +
  theme_bw()


```

## Sex vs SRT

```{r}

SRT <- c("S1", "S2", "SEB", "CEFX")
my_comparisons <- list(c("Männlich", "Weiblich"))

facs %>%
  left_join(., meta) %>% 
  select(PatID_Studie1, Timepoint, Marker1, Marker2, S1, S2, SEB, CEFX, Sex) %>% 
  mutate(Timepoint = replace(Timepoint, PatID_Studie1=="435", "W 2")) -> SRT_sex

# CD4

for(i in SRT)
  print(
    SRT_sex %>%
      filter(!is.na(Sex)) %>%
      filter(Marker1 == "CD4") %>% 
      as.data.frame() %>%
      filter(!is.na(!!sym(i))) %>%
        ggplot(aes(x = Sex, y = !!sym(i))) +
          geom_point(alpha = 0.7) + 
          geom_violin() + geom_jitter(width = 0.1, aes(color = factor(Timepoint))) + 
          geom_boxplot(width=.1, alpha = 0.2) +
          theme_bw() +
          ggtitle(paste0("Sex vs ", i, " (CD4)")) +
          ylab(i) + 
          scale_y_log10() +
          stat_compare_means(comparisons = my_comparisons)
  )

for(i in SRT)
  print(
    SRT_sex %>%
      filter(!is.na(Sex)) %>%
      filter(Marker1 == "CD4") %>% 
      as.data.frame() %>%
      filter(!is.na(!!sym(i))) %>%
        ggplot(aes(x = Sex, y = !!sym(i))) +
          geom_point(alpha = 0.7) + 
          geom_violin() + geom_jitter(width = 0.1, aes(color = factor(Timepoint))) + 
          geom_boxplot(width=.1, alpha = 0.2) +
          theme_bw() + facet_wrap(~Marker2) +
          ggtitle(paste0("Sex vs ", i, " (CD4)")) +
          ylab(i) + 
          scale_y_log10() +
          stat_compare_means(comparisons = my_comparisons)
  )

# CD8

for(i in SRT)
  print(
    SRT_sex %>%
      filter(!is.na(Sex)) %>%
      filter(Marker1 == "CD8") %>% 
      as.data.frame() %>%
      filter(!is.na(!!sym(i))) %>%
        ggplot(aes(x = Sex, y = !!sym(i))) +
          geom_point(alpha = 0.7) + 
          geom_violin() + geom_jitter(width = 0.1, aes(color = factor(Timepoint))) + 
          geom_boxplot(width=.1, alpha = 0.2) +
          theme_bw() +
          ggtitle(paste0("Sex vs ", i, " (CD8)")) +
          ylab(i) + 
          scale_y_log10() +
          stat_compare_means(comparisons = my_comparisons)
  )

for(i in SRT)
  print(
    SRT_sex %>%
      filter(!is.na(Sex)) %>%
      filter(Marker1 == "CD8") %>% 
      as.data.frame() %>%
      filter(!is.na(!!sym(i))) %>%
        ggplot(aes(x = Sex, y = !!sym(i))) +
          geom_point(alpha = 0.7) + 
          geom_violin() + geom_jitter(width = 0.1, aes(color = factor(Timepoint))) + 
          geom_boxplot(width=.1, alpha = 0.2) +
          theme_bw() + facet_wrap(~Marker2) +
          ggtitle(paste0("Sex vs ", i, " (CD8)")) +
          ylab(i) + 
          scale_y_log10() +
          stat_compare_means(comparisons = my_comparisons)
  )

```

```{r sex_SRT}

for(i in SRT)
  print(
    SRT_sex %>%
      filter(!is.na(i)) %>%
      filter(!is.na(Sex)) %>%
      filter(Marker1 == "CD4") %>% 
      as.data.frame() %>%
      filter(!is.na(!!sym(i))) %>%
        ggplot(aes(x = Sex, y = !!sym(i))) +
          geom_point(alpha = 0.7) + 
          geom_violin() + geom_jitter(width = 0.1, aes(color = factor(Timepoint))) + 
          geom_boxplot(width=.1, alpha = 0.2) +
          theme_bw() + facet_wrap(~factor(Timepoint, 
                                          levels = c('W 2', 'W3-6', 'M2-4', 'after month 5', 'post vacc'))) +
          ggtitle(paste0("Sex vs ", i, " (CD4)")) +
          ylab(i) + 
          scale_y_log10() +
          stat_compare_means(comparisons = my_comparisons)
  )

for(i in SRT)
  print(
    SRT_sex %>%
      filter(!is.na(i)) %>%
      filter(!is.na(Sex)) %>%
      filter(Marker1 == "CD8") %>% 
      as.data.frame() %>%
      filter(!is.na(!!sym(i))) %>%
        ggplot(aes(x = Sex, y = !!sym(i))) +
          geom_point(alpha = 0.7) + 
          geom_violin() + geom_jitter(width = 0.1, aes(color = factor(Timepoint))) + 
          geom_boxplot(width=.1, alpha = 0.2) +
          theme_bw() + facet_wrap(~Timepoint) +
          ggtitle(paste0("Sex vs ", i, " (CD8)")) +
          ylab(i) + 
          scale_y_log10() +
          stat_compare_means(comparisons = my_comparisons)
  )

```

## Serum ID50 vs disease severity

```{r severity_vs_serum_violin}
breaks <- 10^(-10:10)
minor_breaks <- rep(1:9, 21)*(10^rep(-10:10, each=9))

PNT_Dexa_timepoint <- PNT %>% 
  select(PatID_Studie1, TagPSO, Days, B.1.1.7, B.1.617.2, Dexa) %>% 
  distinct() %>% 
  mutate(Timepoint = rep(0, nrow(.))) %>% 
  filter(!PatID_Studie1 == "183")

for(i in 1:nrow(PNT_Dexa_timepoint))
  #if(is.na(PNT_Dexa_timepoint$Timepoint[i]))
  {
    if(grepl(PNT_Dexa_timepoint$Days[i], pattern = "d25-60"))
      {
        PNT_Dexa_timepoint$Timepoint[i] <- "W3-6"
    } else if(grepl(PNT_Dexa_timepoint$Days[i], pattern = "d39-60"))
      {
        PNT_Dexa_timepoint$Timepoint[i] <- "W3-6"
    } else if(grepl(PNT_Dexa_timepoint$Days[i], pattern = "d39-46"))
      {
        PNT_Dexa_timepoint$Timepoint[i] <- "W3-6"
    } else if(grepl(PNT_Dexa_timepoint$Days[i], pattern = "5-7mo"))
      {
        PNT_Dexa_timepoint$Timepoint[i] <- "after month 5"
    } else if(grepl(PNT_Dexa_timepoint$Days[i], pattern = "PostVac"))
      {
        PNT_Dexa_timepoint$Timepoint[i] <- "post vacc"
    }else if(grepl(PNT_Dexa_timepoint$Days[i], pattern = "2-4mo"))
      {
        PNT_Dexa_timepoint$Timepoint[i] <- "M2-4"
    } else if(grepl(PNT_Dexa_timepoint$Days[i], pattern = "d80-140"))
      {
        PNT_Dexa_timepoint$Timepoint[i] <- "M2-4"
    } else if(grepl(PNT_Dexa_timepoint$TagPSO[i], pattern = "6"))
      {
        PNT_Dexa_timepoint$Timepoint[i] <- "W 2"
    }
  }

# B.1.1.7
level_order <- c('1', '0', '3')
PNT_Dexa_timepoint %>%
  #filter(Marker1 == "CD4") %>%
      as.data.frame() %>%
      ggplot(aes(x = B.1.1.7, y = factor(Dexa, level = level_order))) +
        geom_jitter(width = 0.05) +
        geom_violin(alpha = 0.3) +
        geom_boxplot(width=.1) +
        geom_signif(comparisons = list(c("0", "3")), 
              map_signif_level=TRUE, y_position = 4.5) +
        geom_signif(comparisons = list(c("0", "1")), 
              map_signif_level=TRUE, y_position = 4.7) +
        geom_signif(comparisons = list(c("1", "3")), 
              map_signif_level=TRUE, y_position = 5) +
        scale_x_log10(breaks = breaks, minor_breaks = minor_breaks) +
        annotation_logticks(sides = "l")+
        theme_bw() + facet_wrap(~factor(Timepoint, 
                                        levels=c('W 2', 'W3-6', 'M2-4', 'after month 5', 'post vacc'))) +
        ggtitle("PNT vs severity") +
        ylab("Severity (dexa levels: 1(Dexa), 0(no Dexa), 3(mild))")+
        xlab("Serum ID50: B.1.1.7") + 
        coord_flip()

# B.1.617.2
PNT_Dexa_timepoint %>%
  #filter(Marker1 == "CD4") %>%
      as.data.frame() %>%
      ggplot(aes(x = B.1.617.2, y = factor(Dexa, level = level_order))) +
        geom_jitter(width = 0.05) +
        geom_violin(width = 0.5) +
        geom_boxplot(width=.1) +
        geom_signif(comparisons = list(c("0", "3")), 
              map_signif_level=TRUE, y_position = 4.5) +
        geom_signif(comparisons = list(c("0", "1")), 
              map_signif_level=TRUE, y_position = 4.7) +
        geom_signif(comparisons = list(c("1", "3")), 
              map_signif_level=TRUE, y_position = 5) +
        scale_x_log10(breaks = breaks, minor_breaks = minor_breaks) +
        annotation_logticks(sides = "l")+
        theme_bw() + facet_wrap(~factor(Timepoint, 
                                        levels=c('W 2', 'W3-6', 'M2-4', 'after month 5', 'post vacc'))) +
        ggtitle("PNT vs severity") +
        ylab("Severity (dexa levels: 1(Dexa), 0(no Dexa), 3(mild))") +
        xlab("Serum ID50: B.1.617.2")+ 
        coord_flip()


```

## Age vs Serum ID50

```{r age_vs_serum_violin}

PNT %>% 
  left_join(., meta) %>% 
  select(PatID_Studie1, Sex, Age, B.1.1.7, B.1.617.2, Days) %>% 
  distinct() %>% 
  mutate(Timepoint = rep(0, nrow(.))) %>% 
  filter(!is.na(Sex)) -> PNT_Age_Sex

for(i in 1:nrow(PNT_Age_Sex))
  #if(is.na(PNT_Age_Sex$Timepoint[i]))
  {
    if(grepl(PNT_Age_Sex$Days[i], pattern = "d25-60"))
      {
        PNT_Age_Sex$Timepoint[i] <- "W3-6"
    } else if(grepl(PNT_Age_Sex$Days[i], pattern = "d39-60"))
      {
        PNT_Age_Sex$Timepoint[i] <- "W3-6"
    } else if(grepl(PNT_Age_Sex$Days[i], pattern = "d39-46"))
      {
        PNT_Age_Sex$Timepoint[i] <- "W3-6"
    } else if(grepl(PNT_Age_Sex$Days[i], pattern = "5-7mo"))
      {
        PNT_Age_Sex$Timepoint[i] <- "after month 5"
    } else if(grepl(PNT_Age_Sex$Days[i], pattern = "PostVac"))
      {
        PNT_Age_Sex$Timepoint[i] <- "post vacc"
    }else if(grepl(PNT_Age_Sex$Days[i], pattern = "2-4mo"))
      {
        PNT_Age_Sex$Timepoint[i] <- "M2-4"
    } else if(grepl(PNT_Age_Sex$Days[i], pattern = "d80-140"))
      {
        PNT_Age_Sex$Timepoint[i] <- "M2-4"
    } else if(grepl(PNT_Age_Sex$Days[i], pattern = "6"))
      {
        PNT_Age_Sex$Timepoint[i] <- "W 2"
    }
  }
# B.1.1.7
PNT_Age_Sex %>%
  #filter(Marker1 == "CD4") %>%
      as.data.frame() %>%
      ggplot(aes(x = Age, y = B.1.1.7)) +
        geom_point(alpha = 0.7, aes(color = factor(Timepoint))) + 
        theme_bw() + facet_wrap(.~factor(Timepoint, 
                                         levels = c('W3-6', 'M2-4', 'after month 5', 'post vacc'))) +
        ggtitle("PNT vs Age") +
        ylab("Serum ID50: B.1.1.7 levels") + 
        scale_y_log10() +
        stat_cor(method = "spearman", label.x = 0.2, label.y = 0.2, size = 3)


# B.1.617.2
PNT_Age_Sex %>%
  #filter(Marker1 == "CD4") %>%
      as.data.frame() %>%
      ggplot(aes(x = Age, y = B.1.617.2)) +
        geom_point(alpha = 0.7, aes(color = factor(Timepoint))) + 
        theme_bw() + facet_wrap(.~factor(Timepoint, 
                                         levels = c('W3-6', 'M2-4', 'after month 5', 'post vacc'))) +
        ggtitle("PNT vs Age") +
        ylab("Serum ID50: B.1.617.2 levels") + 
        scale_y_log10() +
        stat_cor(method = "spearman", label.x = 0.2, label.y = 0.2, size = 3)


```

## Sex vs Serum ID50

```{r}
my_comparisons <- list(c("Männlich", "Weiblich"))
# B.1.1.7

PNT_Age_Sex %>%
  as.data.frame() %>%
      ggplot(aes(x = Sex, y = B.1.1.7)) +
        #geom_point(alpha = 0.7) + 
        #geom_violin() + 
        geom_jitter(width = 0.1, aes(color = factor(Timepoint))) + 
        geom_boxplot(width=.1, alpha = 0.2) +
        theme_bw() + facet_wrap(.~factor(Timepoint, 
                                         levels = c('W3-6', 'M2-4', 'after month 5', 'post vacc'))) +
        ggtitle("Sex vs B.1.1.7") +
        ylab("Serum ID50: B.1.1.7 levels") + 
        scale_y_log10() +
        stat_compare_means(comparisons = my_comparisons)

# B.1.617.2
PNT_Age_Sex %>%
  as.data.frame() %>%
      ggplot(aes(x = Sex, y = B.1.617.2)) +
        #geom_point(alpha = 0.7) + 
        #geom_violin() + 
        geom_jitter(width = 0.1, aes(color = factor(Timepoint))) + 
        geom_boxplot(width=.1, alpha = 0.2) +
        theme_bw() + facet_wrap(.~factor(Timepoint, 
                                         levels = c('W3-6', 'M2-4', 'after month 5', 'post vacc'))) +
        ggtitle("Sex vs B.1.1.7") +
        ylab("Serum ID50: B.1.1.7 levels") + 
        scale_y_log10() +
        stat_compare_means(comparisons = my_comparisons)


```

<!-- ```{r SRT_w6_cor_PNT_M3} -->

<!-- SRT_w3_6 <- PNT_SRT %>%  -->
<!--   filter(Timepoint == "W3-6") %>% -->
<!--   select(PatID_Studie1, Timepoint, Marker1, Marker2, CEFX, S1, S2, SEB) -->
<!-- PNT_M2_4 <- PNT_SRT %>%  -->
<!--   filter(Timepoint == "M2-4") %>% -->
<!--   select(PatID_Studie1, Timepoint, B.1.1.7, B.1.617.2) -->

<!-- PNT_M5 <- PNT_SRT %>%  -->
<!--   filter(Timepoint == "after month 5") %>% -->
<!--   select(PatID_Studie1, Timepoint, B.1.1.7, B.1.617.2) %>%  -->
<!--   na.omit() -->


<!-- for(i in SRT) -->
<!--   print(PNT_SRT ) -->


<!-- ``` -->

## Correlation between S1 vs S2, S1 vs CEFX, etc, for each marker, separately for CD4 and CD8
```{r }
# All markers together
#CD 4
SRT <- c("S1", "S2", "CEFX", "SEB")
for(i in SRT)
  for(j in SRT)
    if(i != j)
      print(facs %>%
        mutate(Timepoint = str_replace(Timepoint, "1", "post vacc")) %>% 
        filter(Marker1 == "CD4") %>%
        ggplot(., aes_string(x = i, y = j)) + 
                geom_point(alpha = 0.7, aes(color = factor(Dexa), shape = factor(Timepoint))) + 
                theme_bw() + facet_wrap(.~factor(Timepoint, 
                                                 levels = c('W 2', 'W3-6', 'M2-4', 'after month 5', 'post vacc'))) +
                ggtitle("CD4 cells") + 
                stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3))

# CD 8
SRT <- c("S1", "S2", "CEFX", "SEB")
for(i in SRT)
  for(j in SRT)
    if(i != j)
      print(facs  %>%
        mutate(Timepoint = str_replace(Timepoint, "1", "post vacc"))%>%
        filter(Marker1 == "CD8") %>%
        ggplot(., aes_string(x = i, y = j)) + 
                geom_point(alpha = 0.7, aes(color = factor(Dexa), shape = factor(Timepoint))) + 
                theme_bw() + facet_wrap(.~factor(Timepoint, 
                                                 levels = c('W 2', 'W3-6', 'M2-4', 'after month 5', 'post vacc'))) + 
                ggtitle("CD8 cells") + 
                stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3))
```

```{r}
# Separate plots for separate markers
# CD 4
SRT <- c("S1", "S2", "CEFX", "SEB")
for(i in SRT)
  for(j in SRT)
    if(i != j)
      print(facs %>%
        filter(Marker1 == "CD4") %>%
        ggplot(., aes_string(x = i, y = j)) + 
                geom_point(alpha = 0.7, aes(color = factor(Dexa), shape = factor(Timepoint))) + 
                theme_bw() + facet_wrap(.~Marker2, scales = "free_y") + 
                ggtitle("CD4 cells") + 
                stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3))


```

```{r}
# CD 8
SRT <- c("S1", "S2", "CEFX", "SEB")
for(i in SRT)
  for(j in SRT)
    if(i != j)
      print(facs %>%
        filter(Marker1 == "CD8") %>%
        ggplot(., aes_string(x = i, y = j)) + 
                geom_point(alpha = 0.7, aes(color = factor(Dexa), shape = factor(Timepoint))) + 
                theme_bw() + facet_wrap(.~Marker2, scales = "free_y") + 
                ggtitle("CD8 cells") + 
                stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3))


```

\newpage

## Correlation between S1 vs S2, S1 vs CEFX, etc, for each marker, separately for CD4 and CD8

```{r dexa_3}
# dexa_3 CD4

SRT <- c("S1", "S2", "CEFX", "SEB")
for(i in SRT)
  for(j in SRT)
    if(i != j)
      print(facs %>% 
        filter(Dexa == 3 & Marker1 == "CD4") %>% 
        ggplot(., aes_string(x = i, y = j)) + 
              geom_point(alpha = 0.7, aes(color = factor(Timepoint))) + 
              theme_bw() + facet_wrap(.~Marker2) + 
              ggtitle("Dexa = 3 (mild COVID), CD4 cells") + 
              stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3))

# dexa 3 CD8

SRT <- c("S1", "S2", "CEFX", "SEB")
for(i in SRT)
  for(j in SRT)
    if(i != j)
      print(facs %>% 
        filter(Dexa == 3 & Marker1 == "CD8") %>% 
        ggplot(., aes_string(x = i, y = j)) + 
              geom_point(alpha = 0.7, aes(color = factor(Timepoint))) + 
              theme_bw() + facet_wrap(.~Marker2) + 
              ggtitle("Dexa = 3 (mild COVID), CD8 cells") + 
              stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3))

```


```{r dexa_0}
# dexa_0 CD4

SRT <- c("S1", "S2", "CEFX", "SEB")
for(i in SRT)
  for(j in SRT)
    if(i != j)
      print(facs %>% 
        filter(Dexa == 0 & Marker1 == "CD4") %>%
        ggplot(., aes_string(x = i, y = j)) + 
              geom_point(alpha = 0.7, aes(color = factor(Timepoint))) + 
              theme_bw() + facet_wrap(.~Marker2) + 
              ggtitle("Dexa = 0 (severe, no dexa), CD4 cells") + 
              stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3))

# dexa 0 CD8
SRT <- c("S1", "S2", "CEFX", "SEB")
for(i in SRT)
  for(j in SRT)
    if(i != j)
      print(facs %>% 
        filter(Dexa == 0 & Marker1 == "CD8") %>%
        ggplot(., aes_string(x = i, y = j)) + 
              geom_point(alpha = 0.7, aes(color = factor(Timepoint))) + 
              theme_bw() + facet_wrap(.~Marker2) + 
              ggtitle("Dexa = 0 (severe, no dexa), CD8 cells") + 
              stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3))

```

```{r dexa_1}
# dexa_1 CD4

SRT <- c("S1", "S2", "CEFX", "SEB")
for(i in SRT)
  for(j in SRT)
    if(i != j)
      print(facs %>% 
        filter(Dexa == 1 & Marker1 == "CD4") %>%
        ggplot(., aes_string(x = i, y = j)) + 
              geom_point(alpha = 0.7, aes(color = factor(Timepoint))) + 
              theme_bw() + facet_wrap(.~Marker2) + 
              ggtitle("Dexa = 1 (severe, dexa treatment), CD4 cells") + 
              stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3))

# dexa 1 CD8

SRT <- c("S1", "S2", "CEFX", "SEB")
for(i in SRT)
  for(j in SRT)
    if(i != j)
      print(facs %>% 
        filter(Dexa == 1 & Marker1 == "CD8") %>%
        ggplot(., aes_string(x = i, y = j)) + 
              geom_point(alpha = 0.7, aes(color = factor(Timepoint))) + 
              theme_bw() + facet_wrap(.~Marker2) + 
              ggtitle("Dexa = 1 (severe, dexa treatment), CD8 cells") + 
              stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3))

```

\newpage

## Correlation between pseudo-neutralisation activity (B.1.1.7 or B.1.617.2) vs S2, S1, CEFX and SEB for each marker, separately for CD4 and CD8

```{r SRT_vs_PNT_1, results = 'hide', fig.show = 'all'}
# all dexa levels

strain <- c("B.1.1.7", "B.1.617.2")
SRT <- c("S1", "S2", "CEFX", "SEB")

PNT %>% 
  left_join(., facs) %>% 
  select(PatID_Studie1, Dexa, Timepoint, S1, S2, CEFX, SEB, B.1.1.7, B.1.617.2, Marker1, Marker2) -> PNT_SRT

for(i in SRT)
  for(j in strain)
    print(PNT_SRT %>%
      filter(Marker1 == "CD4") %>%
      as.data.frame() %>%
      ggplot(., aes_string(x = j, y = i)) +
        geom_point(alpha = 0.7, aes(color = factor(Dexa), shape = factor(Timepoint))) +
        theme_bw() +
        ggtitle("CD4 cells") +
        stat_cor(method = "kendall", label.x = 0.2, label.y = 0.2, size = 3))


for(i in SRT)
  for(j in strain)
    print(PNT_SRT %>%
      filter(Marker1 == "CD8") %>%
      as.data.frame() %>%
      ggplot(., aes_string(x = j, y = i)) +
        geom_point(alpha = 0.7, aes(color = factor(Dexa), shape = factor(Timepoint))) +
        theme_bw() +
        ggtitle("CD8 cells") +
        stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3))
```


```{r SRT_vs_PNT, results = 'hide', fig.show = 'all'}
# all dexa levels

strain <- c("B.1.1.7", "B.1.617.2")
SRT <- c("S1", "S2", "CEFX", "SEB")


for(i in SRT)
  for(j in strain)
    print(PNT_SRT %>%
      filter(Marker1 == "CD4") %>%
      as.data.frame() %>%
      ggplot(., aes_string(x = j, y = i)) +
        geom_point(alpha = 0.7, aes(color = factor(Dexa), shape = factor(Timepoint))) +
        theme_bw() + facet_wrap(.~Marker2) +
        ggtitle("CD4 cells") +
        stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3))


for(i in SRT)
  for(j in strain)
    print(PNT_SRT %>%
      filter(Marker1 == "CD8") %>%
      as.data.frame() %>%
      ggplot(., aes_string(x = j, y = i)) +
        geom_point(alpha = 0.7, aes(color = factor(Dexa), shape = factor(Timepoint))) +
        theme_bw() + facet_wrap(.~Marker2) +
        ggtitle("CD8 cells") +
        stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3))
```

```{r, results = 'hide', fig.show = 'all'}

for(i in SRT)
  for(j in strain)
    print(PNT_SRT %>%
      filter(Marker1 == "CD4") %>%
      as.data.frame() %>%
      ggplot(., aes_string(x = j, y = i)) +
        geom_point(alpha = 0.7, aes(color = factor(Dexa), shape = factor(Timepoint))) +
        theme_bw() + facet_wrap(.~Timepoint) +
        ggtitle("CD4 cells") +
        stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3))


for(i in SRT)
  for(j in strain)
    print(PNT_SRT %>%
      filter(Marker1 == "CD8") %>%
      as.data.frame() %>%
      ggplot(., aes_string(x = j, y = i)) +
        geom_point(alpha = 0.7, aes(color = factor(Dexa), shape = factor(Timepoint))) +
        theme_bw() + facet_wrap(.~Timepoint) +
        ggtitle("CD8 cells") +
        stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3))
```

<!-- ```{r , results = 'hide', fig.show = 'all'} -->
<!-- strain <- c("B.1.1.7", "B.1.617.2") -->
<!-- SRT <- c("S1", "S2", "CEFX", "SEB") -->

<!-- #dexa 3 -->
<!-- for(i in SRT) -->
<!--   for(j in strain) -->
<!--     print(PNT_SRT %>% -->
<!--       filter(Dexa == 3 & Marker1 == "CD4") %>% -->
<!--       as.data.frame() %>% -->
<!--       ggplot(., aes_string(x = j, y = i)) + -->
<!--         geom_point(alpha = 0.7, aes(color = TagPSO)) + -->
<!--         theme_bw() + facet_wrap(.~Marker2) + -->
<!--         ggtitle("Dexa = 3 (mild COVID), CD4 cells") + -->
<!--         stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3)) -->



<!-- for(i in SRT) -->
<!--   for(j in strain) -->
<!--     print(PNT_SRT %>% -->
<!--       filter(Dexa == 3 & Marker1 == "CD8") %>% -->
<!--       as.data.frame() %>% -->
<!--       ggplot(., aes_string(x = j, y = i)) + -->
<!--         geom_point(alpha = 0.7, aes(color = factor(Timepoint))) + -->
<!--         theme_bw() + facet_wrap(.~Marker2) + -->
<!--         ggtitle("Dexa = 3 (mild COVID), CD8 cells") + -->
<!--         stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3)) -->
<!-- ``` -->

<!-- ```{r, results = 'hide', fig.show = 'all'} -->
<!-- #dexa 0 -->
<!-- for(i in SRT) -->
<!--   for(j in strain) -->
<!--     print(PNT_SRT %>% -->
<!--       filter(Dexa == 0 & Marker1 == "CD4") %>% -->
<!--       as.data.frame() %>% -->
<!--       ggplot(., aes_string(x = j, y = i)) + -->
<!--         geom_point(alpha = 0.7, aes(color = factor(Timepoint))) + -->
<!--         theme_bw() + facet_wrap(.~Marker2) + -->
<!--         ggtitle("Dexa = 0 (severe no dexa), CD4 cells") + -->
<!--         stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3)) -->


<!-- for(i in SRT) -->
<!--   for(j in strain) -->
<!--     print(PNT_SRT %>% -->
<!--       filter(Dexa == 0 & Marker1 == "CD8") %>% -->
<!--       as.data.frame() %>% -->
<!--       ggplot(., aes_string(x = j, y = i)) + -->
<!--         geom_point(alpha = 0.7, aes(color = factor(Timepoint))) + -->
<!--         theme_bw() + facet_wrap(.~Marker2) + -->
<!--         ggtitle("Dexa = 0 (severe no dexa), CD8 cells") + -->
<!--         stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3)) -->
<!-- ``` -->

<!-- ```{r, results = 'hide', fig.show = 'all'} -->
<!-- #dexa 1 -->
<!-- for(i in SRT) -->
<!--   for(j in strain) -->
<!--     print(PNT_SRT %>% -->
<!--       filter(Dexa == 1 & Marker1 == "CD4") %>% -->
<!--       as.data.frame() %>% -->
<!--       ggplot(., aes_string(x = j, y = i)) + -->
<!--         geom_point(alpha = 0.7, aes(color = factor(Timepoint))) + -->
<!--         theme_bw() + facet_wrap(.~Marker2) + -->
<!--         ggtitle("Dexa = 1 (severe dexa treatment), CD4 cells") + -->
<!--         stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3)) -->

<!-- for(i in SRT) -->
<!--   for(j in strain) -->
<!--     print(PNT_SRT %>% -->
<!--       filter(Dexa == 1 & Marker1 == "CD8") %>% -->
<!--       as.data.frame() %>% -->
<!--       ggplot(., aes_string(x = j, y = i)) + -->
<!--         geom_point(alpha = 0.7, aes(color = factor(Timepoint))) + -->
<!--         theme_bw() + facet_wrap(.~Marker2) + -->
<!--         ggtitle("Dexa = 1 (severe dexa treatment), CD8 cells") + -->
<!--         stat_cor(method = "pearson", label.x = 0.2, label.y = 0.2, size = 3)) -->

<!-- ``` -->

\newpage

## Change in the values of S1, S2, CEFX and SEB with time (days post symptom). Each patient has data for only one time point - all patients are used together for this analysis. Triangle represents mean at that time point

```{r progression}

SRT <- c("S1", "S2", "CEFX", "SEB")

for(i in SRT)
  print(
    facs %>%
      filter(Marker1 == "CD4") %>%
    ggplot(., aes(x = TagPSO, y = !!sym(i), group = Dexa)) + 
      geom_point(alpha = 0.7) + geom_line(aes(color = factor(Dexa), group = Dexa), alpha = 0.4) +
      theme(axis.text.x = element_text(angle = 90)) +
      stat_summary(aes(group = 1), geom = "point", fun = mean, shape = 17, size = 2) +
      #facet_wrap(.~Marker2, scales = "free_y") + 
      ggtitle("CD4") + 
      theme_bw())

for(i in SRT)
  print(
    facs %>%
      filter(Marker1 == "CD8") %>%
    ggplot(., aes(x = Timepoint, y = !!sym(i), group = PatID_Studie1)) + 
      geom_point(alpha = 0.7, aes(color = factor(Dexa))) + geom_line(aes(group = PatID_Studie1), alpha = 0.4) +
      theme(axis.text.x = element_text(angle = 90)) +
      stat_summary(aes(group = 1), geom = "point", fun = mean, shape = 17, size = 2) +
      facet_wrap(.~Marker2, scales = "free_y") + 
      ggtitle("CD8") + 
      theme_bw())


# dexa_3

for(i in SRT)
  print(
    facs %>%
      filter(Dexa == 3 & Marker1 == "CD4") %>%
    ggplot(., aes(x = Timepoint, y = !!sym(i), group = PatID_Studie1)) + 
      geom_point(alpha = 0.7, aes(color = factor(Dexa))) + geom_line(aes(group = PatID_Studie1), alpha = 0.4) +
      stat_summary(aes(group = 1), geom = "point", fun = mean, shape = 17, size = 2) +
      facet_wrap(~Marker2, scales = "free_y") + 
      ggtitle("CD4, Dexa 3") + 
      theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
      theme_bw())


for(i in SRT)
  print(
    facs %>%
      filter(Dexa == 3 & Marker1 == "CD8") %>%
    ggplot(., aes(x = Timepoint, y = !!sym(i), group = PatID_Studie1)) + 
      geom_point(alpha = 0.7, aes(color = factor(Dexa))) + geom_line(aes(group = PatID_Studie1), alpha = 0.4) +
      stat_summary(aes(group = 1), geom = "point", fun = mean, shape = 17, size = 2) +
      facet_wrap(~Marker2, scales = "free_y") + 
      ggtitle("CD8, Dexa 3") + 
      theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
      theme_bw())

# dexa_0

for(i in SRT)
  print(
    facs %>%
      filter(Dexa == 0 & Marker1 == "CD4") %>%
    ggplot(., aes(x = Timepoint, y = !!sym(i), group = PatID_Studie1)) + 
      geom_point(alpha = 0.7, aes(color = factor(Dexa))) + geom_line(aes(group = PatID_Studie1), alpha = 0.4) +
      stat_summary(aes(group = 1), geom = "point", fun = mean, shape = 17, size = 2) +
      facet_wrap(~Marker2, scales = "free_y") + 
      ggtitle("CD4, Dexa 0") + 
      theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
      theme_bw())

for(i in SRT)
  print(
    facs %>%
      filter(Dexa == 0 & Marker1 == "CD8") %>%
    ggplot(., aes(x = Timepoint, y = !!sym(i), group = PatID_Studie1)) + 
      geom_point(alpha = 0.7, aes(color = factor(Dexa))) + geom_line(aes(group = PatID_Studie1), alpha = 0.4) +
      stat_summary(aes(group = 1), geom = "point", fun = mean, shape = 17, size = 2) +
      facet_wrap(~Marker2, scales = "free_y") + 
      ggtitle("CD8, Dexa 0") + 
      theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
      theme_bw())

# dexa 1

for(i in SRT)
  print(
    facs %>%
      filter(Dexa == 1 & Marker1 == "CD4") %>%
    ggplot(., aes(x = Timepoint, y = !!sym(i), group = PatID_Studie1)) + 
      geom_point(alpha = 0.7, aes(color = factor(Dexa))) + geom_line(aes(group = PatID_Studie1), alpha = 0.4) +
      stat_summary(aes(group = 1), geom = "point", fun = mean, shape = 17, size = 2) +
      facet_wrap(~Marker2, scales = "free_y") + 
      ggtitle("CD4, Dexa 1") + 
      theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
      theme_bw())

for(i in SRT)
  print(
    facs %>%
      filter(Dexa == 1 & Marker1 == "CD8") %>%
    ggplot(., aes(x = Timepoint, y = !!sym(i), group = PatID_Studie1)) + 
      geom_point(alpha = 0.7, aes(color = factor(Dexa))) + geom_line(aes(group = PatID_Studie1), alpha = 0.4) +
      stat_summary(aes(group = 1), geom = "point", fun = mean, shape = 17, size = 2) +
      facet_wrap(~Marker2, scales = "free_y") + 
      ggtitle("CD8, Dexa 1") + 
      theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
      theme_bw())
```


<!-- ## Linear models to explain Serum ID50 with Age or (Age and Severity) as predictors of Serum ID50 -->

<!-- ```{r serum_model_linear} -->
<!-- # linear models -->
<!-- model = lm(data = PNT_SRT_meta[which(PNT_SRT_meta$Marker1 == "CD4"),], B.1.1.7 ~ Age) -->
<!-- summary(model) -->
<!-- par(mfrow = c(2,2)) -->
<!-- plot(model) -->

<!-- ggplot(PNT_SRT_meta[which(PNT_SRT_meta$Marker1 == "CD4"),],  -->
<!--        aes(x = Age, y = B.1.1.7)) + -->
<!--   geom_point(alpha = 0.7) + -->
<!--   geom_smooth(method='lm', formula= y~x, se = F) + -->
<!--   theme_bw() + -->
<!--   ggtitle("CD4, B.1.1.7 ~ Age") -->


<!-- # model = lm(data = PNT_SRT_meta[which(PNT_SRT_meta$Marker1 == "CD4"),], B.1.1.7 ~ Age + factor(Dexa)) -->
<!-- # summary(model) -->
<!-- # par(mfrow = c(2,2)) -->
<!-- # plot(model) -->
<!-- #  -->
<!-- # plot(predictorEffect("Age", mod = model)) -->
<!-- # #plot(predictorEffect("Dexa", mod = model)) -->
<!-- #  -->
<!-- model = lm(data = PNT_SRT_meta[which(PNT_SRT_meta$Marker1 == "CD8"),], B.1.1.7 ~ Age) -->
<!-- summary(model) -->
<!-- par(mfrow = c(2,2)) -->
<!-- plot(model) -->

<!-- ggplot(PNT_SRT_meta[which(PNT_SRT_meta$Marker1 == "CD8"),],  -->
<!--        aes(x = Age, y = B.1.1.7)) + -->
<!--   geom_point(alpha = 0.7) + -->
<!--   geom_smooth(method='lm', formula= y~x, se = F) + -->
<!--   theme_bw() + -->
<!--   ggtitle("CD8, B.1.1.7 ~ Age") -->


<!-- model = glm(data = PNT_SRT_meta[which(PNT_SRT_meta$Marker1 == "CD4" & !is.na(PNT_SRT_meta$Sex)),], B.1.1.7 ~ factor(Sex), family = "binomial") -->
<!-- summary(model) -->
<!-- par(mfrow = c(2,2)) -->
<!-- plot(model) -->

<!-- ggplot(PNT_SRT_meta[which(PNT_SRT_meta$Marker1 == "CD4"),],  -->
<!--        aes(x = Sex, y = B.1.1.7)) + -->
<!--   geom_point(alpha = 0.7) + -->
<!--   geom_smooth(method='glm', formula= y~x, family = "binomial", se = F) + -->
<!--   theme_bw() + -->
<!--   ggtitle("CD4, B.1.1.7 ~ Sex") -->

<!-- #plot(predictorEffect("Age", mod = model)) -->

<!-- # model = lm(data = PNT_SRT_meta[which(PNT_SRT_meta$Marker1 == "CD8"),], B.1.1.7 ~ Age + factor(Dexa)) -->
<!-- # summary(model) -->
<!-- # par(mfrow = c(2,2)) -->
<!-- # plot(model) -->
<!-- #  -->
<!-- # plot(predictorEffect("Age", mod = model)) -->
<!-- # #plot(predictorEffect("Dexa", mod = model)) -->
<!-- #  -->
<!-- # model = lm(data = PNT_SRT_meta[which(PNT_SRT_meta$Marker1 == "CD4"),], B.1.617.2 ~ Age) -->
<!-- # summary(model) -->
<!-- # par(mfrow = c(2,2)) -->
<!-- # plot(model) -->
<!-- #  -->
<!-- # plot(predictorEffect("Age", mod = model)) -->
<!-- #  -->
<!-- # model = lm(data = PNT_SRT_meta[which(PNT_SRT_meta$Marker1 == "CD4"),], B.1.617.2 ~ Age + factor(Dexa)) -->
<!-- # summary(model) -->
<!-- # par(mfrow = c(2,2)) -->
<!-- # plot(model) -->
<!-- #  -->
<!-- # plot(predictorEffect("Age", mod = model)) -->
<!-- # #plot(predictorEffect("Dexa", mod = model)) -->
<!-- #  -->
<!-- # model = lm(data = PNT_SRT_meta[which(PNT_SRT_meta$Marker1 == "CD8"),], B.1.617.2 ~ Age) -->
<!-- # summary(model) -->
<!-- # par(mfrow = c(2,2)) -->
<!-- # plot(model) -->
<!-- #  -->
<!-- # plot(predictorEffect("Age", mod = model)) -->
<!-- #  -->
<!-- # model = lm(data = PNT_SRT_meta[which(PNT_SRT_meta$Marker1 == "CD8"),], B.1.617.2 ~ Age + factor(Dexa)) -->
<!-- # summary(model) -->
<!-- # par(mfrow = c(2,2)) -->
<!-- # plot(model) -->
<!-- #  -->
<!-- # plot(predictorEffect("Age", mod = model)) -->
<!-- # #plot(predictorEffect("Dexa", mod = model)) -->

<!-- ``` -->